<head>
</head>
<body>
  <h1>add Tracer</h1>
  <form action="/tracer/add" method="post" name="addTracer">
    <input name="TracerString" value="awef38" />
    <input name="URL" value="https://example.com" />
    <input name="Method" value="GET" />
  <input type="submit" value="Submit">
  </form>

  <textarea id="logs" rows="40" cols="50">
  </textarea>

  <script>
  var exampleSocket = new WebSocket("ws://localhost:8081/realtime");
    var lastWrite = ""
  exampleSocket.onmessage = function (event) {
  console.log(JSON.parse(event.data));
  var test = JSON.parse(event.data)
  var offset = 0
  var logbox = document.getElementById("logs");
  while(true) {
      var location = test.Data.indexOf(test.ID, offset)
      if (location == -1){
        break
      }

      var temp = test.Data.slice(test.Data.lastIndexOf("\n", location),test.Data.indexOf("\n", location))
      if (temp != lastWrite){
        var textnode = document.createTextNode(temp);
        logbox.appendChild(textnode);
      }
      offset = location + 5
      lastWrite = temp
    }
  }


  var form = document.addTracer

  form.onsubmit = function (e) {
  // stop the regular form submission
  e.preventDefault();

  // collect the form data while iterating over the inputs
  var data = {};
  for (var i = 0, ii = form.length; i < ii; ++i) {
    var input = form[i];
    if (input.name) {
      data[input.name] = input.value;
    }
  }

  // construct an HTTP request
  var xhr = new XMLHttpRequest();
  xhr.open(form.method, form.action, true);
  xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

  // send the collected data as JSON
  xhr.send(JSON.stringify(data));
  form.ID.value = makeid();
  xhr.onloadend = function () {
    // done
  };
};

function makeid()
{
    var text = "";
    var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

    for( var i=0; i < 5; i++ )
        text += possible.charAt(Math.floor(Math.random() * possible.length));

    return text;
}
  </script>
</body>



<!-- {"ID":"test","URL":"example.com","Method":"GET" -->
